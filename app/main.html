<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>App index</title>
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" type="text/css" href="css/survey.css">
  <link rel="shortcut icon" type="image/x-icon" href="css/favicon.ico">
  <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <script type="text/javascript" src="js/knockout.js"></script>
  <script type="text/javascript" src="js/ace/ace.js"></script>
  <script type="text/javascript" src="js/ace/worker-json.js"></script>
  <script type="text/javascript" src="js/ace/mode-json.js"></script>
  <script type="text/javascript" src="js/survey.ko.js"></script>
  <script type="text/javascript" src="js/surveyeditor.js"></script>
  <script type="text/javascript" src="js/globalize.min.js"></script>
  <script type="text/javascript" src="js/dx.chartjs.js"></script>
</head>
<body>
<header>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-1">
      <div class="container">
        <a href="http://www.siamsquare.org/admin/?w=login" class="btn btn-warning btn-xs" title="Log in"><i class="pe-power-off pe-fw"></i> Log in</a> <a href="http://www.pebinary.net/en/clients/" class="btn btn-danger btn-xs"><i class="pe-university pe-fw"></i> Help</a>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-2">
      <div class="container">
        <h1><a href="http://www.siamsquare.org/admin/" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><img src="http://www.siamsquare.org/admin/assets/img/ssq.svg" alt="SiamSquare Survey Engine by PE BINARY CO., LTD."></a></h1>
        <p class="description">A survey society where your opinions are highly valued</p>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-3">
      <nav class="navbar navbar-default navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand"><i class="pe-exclamation-triangle pe-fw"></i> Authorised clients only</span>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://www.siamsquare.org/admin/" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><i class="pe-home pe-fw"></i> Home</a></i>
              <li><a href="http://www.siamsquare.org/admin/request.php" title="Request for an access"><i class="pe-ticket pe-fw"></i> Request for an access</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>
<main class="container">



<div class="container body-content">
    <ul class="nav nav-tabs">
        <li data-bind="css: {active: showActive()}"><a class="btn btn-default" data-bind="click: loadActive" href="#">Active Surveys</a></li>
        <li data-bind="css: {active: !showActive()}"><a class="btn btn-default" data-bind="click: loadArchive" href="#">Archived Surveys</a></li>
    </ul>

<div class="panel">
  <div class="panel-body">
    <a class="btn btn-default" data-bind="click: createNew, visible: showActive, enable: !isNewSurveyCreating()" href="#" style="margin:5px">Create New</a>
    <table class="table">
      <thead>
        <tr>
          <th></th>
          <th>Name</th>
          <th>Created At</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr data-bind="visible: isNewSurveyCreating">
          <td></td>
          <td colspan="2"><input type="text" class="form-control" data-bind="textInput: newSurveyName" /></td>
          <td>
            <a class="btn btn-default" data-bind="click: postNew, enable: newSurveyName() != ''" href="#" style="margin:5px">Create</a>
            <a class="btn btn-default" data-bind="click: cancelNew" href="#" style="margin:5px">Cancel</a>
          </td>
        </tr>
        <!-- ko foreach: surveys -->
        <tr>
          <td>
            <a href="#" data-bind="click: $parent.showInfo" title="More Info...">
              <span class="glyphicon" data-bind="css: {'glyphicon-chevron-down': !showInfo(), 'glyphicon-chevron-up': showInfo()}"></span>
            </a>
          </td>
          <td>
            <input data-bind="textInput:editingName, visible: isEditing()" />
            <div data-bind="visible: !isEditing()">
              <span data-bind="text:name"></span>
              <a href="#" data-bind="click: $parent.startEdit, visible: $parent.showActive" title="Change Name">
                <span class="glyphicon glyphicon-edit"></span>
              </a>
            </div>
          </td>
          <td>
            <div data-bind="visible: isEditing()">
              <a class="btn btn-default" data-bind="click: $parent.postEdit, enable: name() != ''" href="#" style="margin:5px">Update</a>
              <a class="btn btn-default" data-bind="click: $parent.cancelEdit" href="#" style="margin:5px">Cancel</a>
            </div>
            <span data-bind="text:createdAt, visible: !isEditing()"></span>
          </td>
          <td>
            <a class="btn btn-default" data-bind="attr: { href: '/Home/EditSurvey/' + id }, visible: $parent.showActive" style="margin:5px">Edit</a>
            <a class="btn btn-default" data-bind="attr: { href: '/Home/SurveyResults/' + id }" style="margin:5px">Results</a>
            <a class="btn btn-default" data-bind="click: $parent.archive, visible: $parent.showActive" href="#" style="margin:5px">Archive</a>
            <a class="btn btn-default" data-bind="click: $parent.restore, visible: !$parent.showActive()" href="#" style="margin:5px">Restore</a>
            <a class="btn btn-default" data-bind="click: $parent.delete, visible: !$parent.showActive()" href="#" style="margin:5px">Delete</a>
          </td>
        </tr>
        <tr data-bind="visible: showInfo">
          <td style="border-top-style:none"></td>
          <td colspan="3" style="border-top-style:none">
            <dl class="dl-horizontal">
              <dt>Id</dt>
              <dd><span data-bind="text: id"></span></dd>
              <dt>ResultId</dt>
              <dd><span data-bind="text: resultId"></span></dd>
              <dt>PostId</dt>
              <dd><span data-bind="text: postId"></span></dd>
            </dl>
          </td>
        </tr>
        <!-- /ko -->
      </tbody>
    </table>
  </div>
</div>


<script type="text/javascript">

        var Survey = function (name, createdAt, id, resultId, postId) {
            this.name = ko.observable(name);
            this.editingName = ko.observable(name);
            this.createdAt = createdAt;
            this.id = id;
            this.resultId = resultId;
            this.postId = postId;

            this.showInfo = ko.observable(false);
            this.isEditing = ko.observable(false);
        }
        var ViewModel = function () {
            var self = this;
            this.surveys = ko.observableArray([]);
            this.url = "/api/MySurveys/";
            this.showActive = ko.observable(true);
            this.isNewSurveyCreating = ko.observable(false);
            this.newSurveyName = ko.observable("");

            this.loadData = function (showActive) {
                self.showActive(showActive);
                var url = showActive ? "getActive" : "getArchive";
                // $.getJSON(self.url + url, function (data) {
                $.getJSON("data/projects.json", function (data) {
                    var list = [];
                    for (var i = 0; i < data.length; i++) {
                        list.push(self.createSurveyObject(data[i]));
                    }
                    self.surveys(list);
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.loadActive = function () {
                self.loadData(true);
            }
            this.loadArchive = function () {
                self.loadData(false);
            }
            this.archive = function (survey) {
                $.get(self.url + "archive?id=" + survey.id, function (data) {
                    self.removeSurvey(survey);
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.restore = function (survey) {
                $.get(self.url + "restore?id=" + survey.id, function (data) {
                    self.removeSurvey(survey);
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.delete = function (survey) {
                $.get(self.url + "delete?id=" + survey.id, function (data) {
                    self.removeSurvey(survey);
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.removeSurvey = function (survey) {
                var index = self.surveys.indexOf(survey);
                if (index > -1) {
                    self.surveys.splice(index, 1);
                }
            }
            this.createNew = function () {
                self.isNewSurveyCreating(true);
                self.newSurveyName("New Survey");
            }
            this.cancelNew = function () {
                self.isNewSurveyCreating(false);
            }
            this.postNew = function () {
                self.cancelNew();
                $.get(self.url + "create?name=" + self.newSurveyName(), function (data) {
                    self.surveys.splice(0, 0, self.createSurveyObject(data))
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.startEdit = function (survey) {
                survey.editingName(survey.name());
                survey.isEditing(true);
            }
            this.postEdit = function (survey) {
                self.cancelEdit(survey);
                $.get(self.url + "changeName?id=" + survey.id + "&name=" + survey.editingName(), function (data) {
                    survey.name(survey.editingName());
                }).fail(function (error) {
                    self.onFail(error);
                });
            }
            this.cancelEdit = function (survey) {
                survey.isEditing(false);
            }
            this.createSurveyObject = function (data) {
                var createdAt = new Date(data.CreatedAt);
                if (createdAt) {
                    createdAt = createdAt.toDateString();
                }
                return new Survey(data.Name, createdAt, data.Id, data.ResultId, data.PostId);
            }
            this.onFail = function (error) {
                alert(JSON.stringify(error));
            }
            this.showInfo = function (survey) {
                survey.showInfo(!survey.showInfo());
            }
            this.loadActive();
        }
        jQuery(document).ready(function () {
            ko.applyBindings(new ViewModel());
        });

</script>



</main>
<footer>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-1">
      <div class="container">
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-2">
      <div class="container">
        <a href="MYHOME" class="footerlogo-ssq" title="MYDESC"><span class="ssqlogo1">Siam</span><span class="ssqlogo2">Square</span></a> by
        <a href="http://www.pebinary.com" class="footerlogo" title="PE BINARY CO., LTD."><span class="logo1"><i class="pe-logo"></i></span> <span class="logo2">pe</span><span class="logo3">binary</span></a><br>
        <i class="pe-copyright"></i> Copyright 2016, All rights reserved.<br>
        <nav class="footer">
          <ul class="list-inline" itemscope itemtype="http://schema.org/SiteNavigationElement">
            <li><a href="http://www.pebinary.com/about/privacy.html" title="Privacy policy" itemprop="url"><i class="pe-lock"></i> <span class="hidden-md hidden-lg" itemprop="name">Privacy</span><span class="hidden-xs hidden-sm" itemprop="name">Privacy policy</span></a></li>
            <li><a href="http://www.pebinary.com/about/tos.html" title="Terms of services" itemprop="url"><i class="pe-gavel"></i> <span class="hidden-md hidden-lg" itemprop="name">TOS</span><span class="hidden-xs hidden-sm" itemprop="name">Terms of services</span></a></li>
            <li><a href="http://www.pebinary.com/about/terms.html" title="Terms &amp; conditions" itemprop="url"><i class="pe-balance-scale"></i> <span class="hidden-md hidden-lg" itemprop="name">Terms</span><span class="hidden-xs hidden-sm" itemprop="name">Terms &amp; conditions</span></a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-3">
      <div class="container">
        <h4 class="avatar">&#9836; &#9819; &#9962; &#9969; &#9748; &#10000; &#10175; &#9820; &#9822; &#9731; &#9973; &#8485; &#8488; &#8523; &#8492; &#9961;</h4>
      </div>
    </div>
  </div>
</footer>
<div class="scroll-to-top"><i class="pe-arrow-up pe-lg"></i></div>
<script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBhLjEc1SwSq06Pg494R6pdM2NqLHF8Ag0",
    authDomain: "siamsquare-6f543.firebaseapp.com",
    databaseURL: "https://siamsquare-6f543.firebaseio.com",
    storageBucket: "siamsquare-6f543.appspot.com",
    messagingSenderId: "485767684184"
  };
  firebase.initializeApp(config);
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-82554411-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
