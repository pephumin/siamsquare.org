<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>App editor</title>
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" type="text/css" href="css/survey.css">
  <link rel="shortcut icon" type="image/x-icon" href="css/favicon.ico">
  <script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.js"></script>
  <script type="text/javascript" src="js/knockout.js"></script>
  <script type="text/javascript" src="js/ace/ace.js"></script>
  <script type="text/javascript" src="js/ace/worker-json.js"></script>
  <script type="text/javascript" src="js/ace/mode-json.js"></script>
  <script type="text/javascript" src="js/survey.ko.js"></script>
  <script type="text/javascript" src="js/surveyeditor.js"></script>
  <script type="text/javascript" src="js/globalize.min.js"></script>
  <script type="text/javascript" src="js/dx.chartjs.js"></script>
</head>
<body>
<header>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-1">
      <div class="container">
        <a href="http://www.siamsquare.org/admin/?w=login" class="btn btn-warning btn-xs" title="Log in"><i class="pe-power-off pe-fw"></i> Log in</a> <a href="http://www.pebinary.net/en/clients/" class="btn btn-danger btn-xs"><i class="pe-university pe-fw"></i> Help</a>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-2">
      <div class="container">
        <h1><a href="http://www.siamsquare.org/admin/" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><img src="http://www.siamsquare.org/admin/assets/img/ssq.svg" alt="SiamSquare Survey Engine by PE BINARY CO., LTD."></a></h1>
        <p class="description">A survey society where your opinions are highly valued</p>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-3">
      <nav class="navbar navbar-default navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span class="navbar-brand"><i class="pe-exclamation-triangle pe-fw"></i> Authorised clients only</span>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://www.siamsquare.org/admin/" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><i class="pe-home pe-fw"></i> Home</a></i>
              <li><a href="http://www.siamsquare.org/admin/request.php" title="Request for an access"><i class="pe-ticket pe-fw"></i> Request for an access</a></li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>
<main class="container">

<h2>Edit Survey: <em>Survey name</em></h2>
    <!-- <div style="margin-bottom:5px;margin-top:10px"><a href='/Home/RunSurvey/fb79b5c0-3ad5-44ab-ac5e-4834250f22d6' }" target="_blank">Test your survey on a separate page</a>. Remember to save the survey first.</div> -->
<div id="publishRoot" style="display: table-cell; vertical-align:middle">
  <div data-bind="visible:!isPublished()"  style="display:none">
    <button data-bind="click:publish">Publish the survey</button>
  </div>
  <div data-bind="visible:isPublished" style="display:none">
    <button data-bind="click:unPublish">Stop publishing the survey</button>
    <a data-bind="attr:{href:url}" target="_blank">Run the survey </a>
    <input type="checkbox" data-bind="checked:useCookies" /><span> Use Cookies</span>
  </div>
</div>

<br>

<div id="editor" style="min-width:100%; width:100%"></div>



<script type="text/javascript">

  function getParameterByName(name, url) {
    if (!url) url = window.location.href;
    url = url.toLowerCase();
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
      results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
  }

  var options = {
    questionTypes: ["rating", "radiogroup", "dropdown", "checkbox", "text", "multipletext", "comment", "file", "matrix", "matrixdropdown", "matrixdynamic", "html"],
    //alwaySaveTextInPropertyEditors : false
  };
  options.generateValidJSON = true;

  var editor = new SurveyEditor.SurveyEditor("editor", options);
  editor.showOptions = true;
  editor.generateValidJSONChangedCallback = function(newValue) {
    $.get("/api/MySurveys/setGenerationJSONType?generateValidJSON="+ newValue, function (data) {
    }).fail(function (error) {
    });
  };

  var surveyId = getParameterByName("surveyid");
  if(surveyId) { editor.loadSurvey(surveyId); }

  // modelData = {
  //   "Json": null,
  //   "Text": null,
  //   "GenerateValidJSON": true,
  //   "Name": "New Survey",
  //   "IsArchived": false,
  //   "UserId": "cb705132-d953-48c3-9856-223fbae49d06",
  //   "PostId": "859d7210-471b-4039-a679-78c58425aea6",
  //   "ResultId": "566d7b43-885a-49f4-b80f-405e66a42a82",
  //   "PublishId": null,
  //   "IsPublished": false,
  //   "UseCookies": false,
  //   "CreatedAt": "2016-10-17T09:22:51.8235264",
  //   "AllowAccessResult": false,
  //   "StoreIPAddress": false,
  //   "Id": "d7f01db8-1573-4579-b4dd-469073b9f0d8",
  //   "Data": {
  //     "Id": "d7f01db8-1573-4579-b4dd-469073b9f0d8"
  //   }
  // }

  modelData = {
    "Json": "{\"locale\":\"th\",\"pages\":[{\"name\":\"หน้าแรก\",\"questions\":[{\"type\":\"checkbox\",\"choices\":[{\"value\":\"A1\",\"text\":\"iPhone\"},{\"value\":\"A2\",\"text\":\"iPad mini\"},{\"value\":\"A3\",\"text\":\"iPad Air\"},{\"value\":\"A4\",\"text\":\"iPad Pro\"}],\"choicesOrder\":\"asc\",\"commentText\":\"นี่มันคืออะไรเนี่ย\",\"hasOther\":true,\"isRequired\":true,\"name\":\"Q1\",\"otherErrorText\":\"อื่นๆก็มี Error ได้สินะ\",\"otherText\":\"อื่นๆ (ระบุ)\",\"title\":\"What is my name?\"},{\"type\":\"radiogroup\",\"name\":\"Q2\",\"title\":\"How many gf do I have?\",\"isRequired\":true,\"choices\":[{\"value\":\"1\",\"text\":\"One\"},{\"value\":\"2\",\"text\":\"Two\"},{\"value\":\"3\",\"text\":\"Three\"},{\"value\":\"4\",\"text\":\"Four\"},{\"value\":\"5+\",\"text\":\"Five or more\"}],\"otherText\":\"อื่นๆ (ระบุ)\"},{\"type\":\"comment\",\"name\":\"Q3\",\"title\":\"Any comments?\",\"isRequired\":true}],\"title\":\"เอายังไง\"},{\"name\":\"หน้าสุดท้าย\",\"questions\":[{\"type\":\"rating\",\"name\":\"Q4\",\"title\":\"What is my overall satisfaction to my gf?\",\"isRequired\":true,\"mininumRateDescription\":\"Not at all satisfied\",\"maximumRateDescription\":\"Very satisfied\"},{\"type\":\"radiogroup\",\"name\":\"Q5\",\"title\":\"Do I own a car?\",\"isRequired\":true,\"choices\":[{\"value\":\"Y\",\"text\":\"Yes\"},{\"value\":\"N\",\"text\":\"No\"}],\"otherText\":\"อื่นๆ (ระบุ)\"},{\"type\":\"checkbox\",\"choices\":[{\"value\":\"JP1\",\"text\":\"Toyota\"},{\"value\":\"JP2\",\"text\":\"Honda\"},{\"value\":\"JP3\",\"text\":\"Mitsubishi\"},{\"value\":\"JP4\",\"text\":\"Nissan\"},{\"value\":\"EU1\",\"text\":\"Mercedes\"},{\"value\":\"EU2\",\"text\":\"BMW\"},{\"value\":\"EU3\",\"text\":\"Volvo\"},{\"value\":\"EU4\",\"text\":\"Chevrolet\"},{\"value\":\"O1\",\"text\":\"Others\"},{\"value\":\"O2\",\"text\":\"Others\"}],\"choicesOrder\":\"random\",\"colCount\":2,\"name\":\"Q6\",\"otherText\":\"Others (describe)\",\"title\":\"What brands of cars do I currently own?\"}],\"title\":\"ยังไงก็ได้\"}],\"showProgressBar\":\"top\",\"storeOthersAsComment\":false,\"title\":\"Project Domino\"}",
    "Text": "{\"locale\":\"th\",\"pages\":[{\"name\":\"หน้าแรก\",\"questions\":[{\"type\":\"checkbox\",\"choices\":[{\"value\":\"A1\",\"text\":\"iPhone\"},{\"value\":\"A2\",\"text\":\"iPad mini\"},{\"value\":\"A3\",\"text\":\"iPad Air\"},{\"value\":\"A4\",\"text\":\"iPad Pro\"}],\"choicesOrder\":\"asc\",\"commentText\":\"นี่มันคืออะไรเนี่ย\",\"hasOther\":true,\"isRequired\":true,\"name\":\"Q1\",\"otherErrorText\":\"อื่นๆก็มี Error ได้สินะ\",\"otherText\":\"อื่นๆ (ระบุ)\",\"title\":\"What is my name?\"},{\"type\":\"radiogroup\",\"name\":\"Q2\",\"title\":\"How many gf do I have?\",\"isRequired\":true,\"choices\":[{\"value\":\"1\",\"text\":\"One\"},{\"value\":\"2\",\"text\":\"Two\"},{\"value\":\"3\",\"text\":\"Three\"},{\"value\":\"4\",\"text\":\"Four\"},{\"value\":\"5+\",\"text\":\"Five or more\"}],\"otherText\":\"อื่นๆ (ระบุ)\"},{\"type\":\"comment\",\"name\":\"Q3\",\"title\":\"Any comments?\",\"isRequired\":true}],\"title\":\"เอายังไง\"},{\"name\":\"หน้าสุดท้าย\",\"questions\":[{\"type\":\"rating\",\"name\":\"Q4\",\"title\":\"What is my overall satisfaction to my gf?\",\"isRequired\":true,\"mininumRateDescription\":\"Not at all satisfied\",\"maximumRateDescription\":\"Very satisfied\"},{\"type\":\"radiogroup\",\"name\":\"Q5\",\"title\":\"Do I own a car?\",\"isRequired\":true,\"choices\":[{\"value\":\"Y\",\"text\":\"Yes\"},{\"value\":\"N\",\"text\":\"No\"}],\"otherText\":\"อื่นๆ (ระบุ)\"},{\"type\":\"checkbox\",\"choices\":[{\"value\":\"JP1\",\"text\":\"Toyota\"},{\"value\":\"JP2\",\"text\":\"Honda\"},{\"value\":\"JP3\",\"text\":\"Mitsubishi\"},{\"value\":\"JP4\",\"text\":\"Nissan\"},{\"value\":\"EU1\",\"text\":\"Mercedes\"},{\"value\":\"EU2\",\"text\":\"BMW\"},{\"value\":\"EU3\",\"text\":\"Volvo\"},{\"value\":\"EU4\",\"text\":\"Chevrolet\"},{\"value\":\"O1\",\"text\":\"Others\"},{\"value\":\"O2\",\"text\":\"Others\"}],\"choicesOrder\":\"random\",\"colCount\":2,\"name\":\"Q6\",\"otherText\":\"Others (describe)\",\"title\":\"What brands of cars do I currently own?\"}],\"title\":\"ยังไงก็ได้\"}],\"showProgressBar\":\"top\",\"storeOthersAsComment\":false,\"title\":\"Project Domino\"}",
    "GenerateValidJSON": true,
    "Name": "Bird",
    "IsArchived": false,
    "UserId": "cb705132-d953-48c3-9856-223fbae49d06",
    "PostId": "4f74cc5f-c610-4b93-9e70-8d32015367a2",
    "ResultId": "e27d71a3-dd74-4e83-b5aa-3b25a12b2b06",
    "PublishId": "9edaf7af-87f3-41d0-9125-454910fed4cb",
    "IsPublished": false,
    "UseCookies": false,
    "CreatedAt": "2016-10-11T01:52:28.2132412",
    "AllowAccessResult": true,
    "StoreIPAddress": true,
    "Id": "ba876803-471f-46c2-b990-a562a2a1b02f",
    "Data": {
      "Id": "ba876803-471f-46c2-b990-a562a2a1b02f"
    }
  };

  if(modelData.Text) {
    editor.text = modelData.Text;
  }
  editor.surveyId = modelData.Id;
  editor.surveyPostId = modelData.PostId;
  editor.saveSurveyFunc =  function() {
    $.ajax({
      url: "/api/MySurveys/changeJson",
      type: "POST",
      data: { Id: modelData.Id, Text: editor.text, Json : editor.text },
      success: function (data) {
        if (data.isSuccess) {
        }
      }
    });
  }
  var PublishSurveyModel = function (isPublished, publishedId, useCookies) {
    var self = this;
    self.serviceUrl = "/api/MySurveys/";
    self.isPublished = ko.observable(isPublished);
    self.publishedId = ko.observable(publishedId);
    self.useCookies = ko.observable(useCookies);
    self.useCookies.subscribe(function(newValue) { self.setUseCookies(newValue); });
    self.url = ko.computed(function(){ return "/published?id=" + self.publishedId();}, self);
    self.publish = function () {
      $.get(self.serviceUrl + "publish?id=(d7f01db8-1573-4579-b4dd-469073b9f0d8)&generateNewId=false", function (data) {
        self.publishedId(data);
        self.isPublished(true);
      }).fail(function (error) { self.onFail(error); });
    }
    self.unPublish = function() {
      $.get(self.serviceUrl + "unpublish?id=(d7f01db8-1573-4579-b4dd-469073b9f0d8)", function (data) {
        self.isPublished(false);
      }).fail(function (error) { self.onFail(error); });
    }
    self.setUseCookies = function(useCookies) {
      $.get(self.serviceUrl + "setUseCookies?id=(d7f01db8-1573-4579-b4dd-469073b9f0d8)&useCookies=" + useCookies, function (data) {
      }).fail(function (error) { self.onFail(error); });
    }
    self.onFail = function (error) {
      alert(JSON.stringify(error));
    }
  }
  jQuery(document).ready(function () {
    ko.applyBindings(new PublishSurveyModel('False' == 'True', '', 'False' == 'True'), document.getElementById("publishRoot"));
  });
</script>

</main>
<footer>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-1">
      <div class="container">
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-2">
      <div class="container">
        <a href="MYHOME" class="footerlogo-ssq" title="MYDESC"><span class="ssqlogo1">Siam</span><span class="ssqlogo2">Square</span></a> by
        <a href="http://www.pebinary.com" class="footerlogo" title="PE BINARY CO., LTD."><span class="logo1"><i class="pe-logo"></i></span> <span class="logo2">pe</span><span class="logo3">binary</span></a><br>
        <i class="pe-copyright"></i> Copyright 2016, All rights reserved.<br>
        <nav class="footer">
          <ul class="list-inline" itemscope itemtype="http://schema.org/SiteNavigationElement">
            <li><a href="http://www.pebinary.com/about/privacy.html" title="Privacy policy" itemprop="url"><i class="pe-lock"></i> <span class="hidden-md hidden-lg" itemprop="name">Privacy</span><span class="hidden-xs hidden-sm" itemprop="name">Privacy policy</span></a></li>
            <li><a href="http://www.pebinary.com/about/tos.html" title="Terms of services" itemprop="url"><i class="pe-gavel"></i> <span class="hidden-md hidden-lg" itemprop="name">TOS</span><span class="hidden-xs hidden-sm" itemprop="name">Terms of services</span></a></li>
            <li><a href="http://www.pebinary.com/about/terms.html" title="Terms &amp; conditions" itemprop="url"><i class="pe-balance-scale"></i> <span class="hidden-md hidden-lg" itemprop="name">Terms</span><span class="hidden-xs hidden-sm" itemprop="name">Terms &amp; conditions</span></a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-3">
      <div class="container">
        <h4 class="avatar">&#9836; &#9819; &#9962; &#9969; &#9748; &#10000; &#10175; &#9820; &#9822; &#9731; &#9973; &#8485; &#8488; &#8523; &#8492; &#9961;</h4>
      </div>
    </div>
  </div>
</footer>
<div class="scroll-to-top"><i class="pe-arrow-up pe-lg"></i></div>
<script src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyBhLjEc1SwSq06Pg494R6pdM2NqLHF8Ag0",
    authDomain: "siamsquare-6f543.firebaseapp.com",
    databaseURL: "https://siamsquare-6f543.firebaseio.com",
    storageBucket: "siamsquare-6f543.appspot.com",
    messagingSenderId: "485767684184"
  };
  firebase.initializeApp(config);
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-82554411-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
