<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Main</title>
  <link rel="stylesheet" type="text/css" href="assets/css/admin.css">
  <link rel="stylesheet" type="text/css" href="assets/css/survey.css">
  <link rel="stylesheet" type="text/css" href="assets/css/firebase.css">
  <link rel="shortcut icon" type="image/x-icon" href="assets/icons/favicon.ico">
  <script type="text/javascript" src="assets/js/jquery-2.1.4.min.js"></script>
  <script type="text/javascript" src="assets/js/bootstrap.js"></script>
  <script type="text/javascript" src="assets/js/fv/formValidation.min.js"></script>
  <script type="text/javascript" src="assets/js/fv/bootstrap.min.js"></script>
  <script type="text/javascript" src="assets/js/knockout.js"></script>
  <script type="text/javascript" src="assets/js/ace/ace.js"></script>
  <script type="text/javascript" src="assets/js/ace/worker-json.js"></script>
  <script type="text/javascript" src="assets/js/ace/mode-json.js"></script>
  <script type="text/javascript" src="assets/js/survey.ko.js"></script>
  <script type="text/javascript" src="assets/js/surveyeditor.js"></script>
  <script type="text/javascript" src="assets/js/globalize.min.js"></script>
  <script type="text/javascript" src="assets/js/dx.chartjs.js"></script>
  <script type="text/javascript" src="assets/js/moment.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/3.4.1/firebase.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/firebasejs/ui/live/0.5/firebase-ui-auth.js"></script>
  <script type="text/javascript">
    var config = {
      apiKey: "AIzaSyBhLjEc1SwSq06Pg494R6pdM2NqLHF8Ag0",
      authDomain: "siamsquare-6f543.firebaseapp.com",
      databaseURL: "https://siamsquare-6f543.firebaseio.com",
      storageBucket: "siamsquare-6f543.appspot.com",
      messagingSenderId: "485767684184"
    };
    firebase.initializeApp(config);
  </script>
  <!-- <script type="text/javascript" src="assets/js/firebase.js"></script> -->
  <script type="text/javascript">
    var uiConfig = {
      'callbacks': {
        'signInSuccess': function(user, credential, redirectUrl) {
          handleSignedInUser(user);
          // Do not redirect.
          return false;
        }
      },
      'signInFlow': 'popup',
      'signInOptions': [{
          provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,
          scopes: ['https://www.googleapis.com/auth/plus.login'
        ]}, {
          provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID,
          scopes :[ 'public_profile', 'email', 'user_likes', 'user_friends' ]
        },
        // firebase.auth.TwitterAuthProvider.PROVIDER_ID,
        // firebase.auth.GithubAuthProvider.PROVIDER_ID,
        firebase.auth.EmailAuthProvider.PROVIDER_ID
      ],
      'tosUrl': 'http://www.pebinary.com/about/tos.html'
    };

    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    var currentUid = null;
    var signInWithRedirect = function() { window.location.assign('widget.html'); };
    var signInWithPopup = function() { window.open('widget.html', 'Sign In', 'width=985,height=735'); };
    var handleSignedInUser = function(user) {
      currentUid = user.uid;
      // document.getElementById('user-signed-in').style.display = 'block';
      // document.getElementById('user-signed-out').style.display = 'none';
      document.getElementById('div-signed-in-1').style.display = 'block';
      document.getElementById('div-signed-in-2').style.display = 'block';
      document.getElementById('div-signed-in-3').style.display = 'block';
      document.getElementById('div-signed-in-4').style.display = 'block';
      document.getElementById('div-signed-out-1').style.display = 'none';
      document.getElementById('div-signed-out-2').style.display = 'none';
      document.getElementById('div-signed-out-3').style.display = 'none';
      document.getElementById('div-signed-out-4').style.display = 'none';
      document.getElementById('name').textContent = user.displayName;
      document.getElementById('email').textContent = user.email;
      if (user.photoURL) {
        document.getElementById('photo').src = user.photoURL;
        document.getElementById('photo').style.display = 'block';
      }
      else { document.getElementById('photo').style.display = 'none'; }
    };
    var handleSignedOutUser = function() {
      // document.getElementById('user-signed-in').style.display = 'none';
      // document.getElementById('user-signed-out').style.display = 'block';
      document.getElementById('div-signed-in-1').style.display = 'none';
      document.getElementById('div-signed-in-2').style.display = 'none';
      document.getElementById('div-signed-in-3').style.display = 'none';
      document.getElementById('div-signed-in-4').style.display = 'none';
      document.getElementById('div-signed-out-1').style.display = 'block';
      document.getElementById('div-signed-out-2').style.display = 'block';
      document.getElementById('div-signed-out-3').style.display = 'block';
      document.getElementById('div-signed-out-4').style.display = 'block';
      ui.start('#firebaseui-container', uiConfig);
    };
    var sendEmailVerification = function() {
      firebase.auth().currentUser.sendEmailVerification().then(function() { alert('Email Verification Sent!'); });
    }
    var sendPasswordReset = function() {
      var email = document.getElementById('email').value;
      firebase.auth().sendPasswordResetEmail(email).then(function() { alert('Password Reset Email Sent!'); }).catch(function(error) {
        var errorCode = error.code;
        var errorMessage = error.message;
        if (errorCode == 'auth/invalid-email') { alert(errorMessage); }
        else if (errorCode == 'auth/user-not-found') { alert(errorMessage); }
        console.log(error);
      });
    }
    firebase.auth().onAuthStateChanged(function(user) {
      if (user && user.uid == currentUid) { return; }
      document.getElementById('loading').style.display = 'none';
      document.getElementById('loaded').style.display = 'block';
      user ? handleSignedInUser(user) : handleSignedOutUser();
    });
    var initApp = function() {
      document.getElementById('sign-in-with-redirect').addEventListener('click', signInWithRedirect);
      document.getElementById('sign-in-with-popup').addEventListener('click', signInWithPopup);
      document.getElementById('sign-out').addEventListener('click', function() { firebase.auth().signOut(); });
      document.getElementById('delete-account').addEventListener('click', function() { firebase.auth().currentUser.delete(); });
    };
    window.addEventListener('load', initApp);
    initApp = function() {
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) { // User is signed in.
          var displayName = user.displayName;
          var email = user.email;
          var emailVerified = user.emailVerified;
          var photoURL = user.photoURL;
          var uid = user.uid;
          var providerData = user.providerData;
          user.getToken().then(function(accessToken) {
            // document.getElementById('sign-in-status').textContent = 'Signed in';
            // document.getElementById('sign-in').textContent = 'Sign out';
            document.getElementById('displayName').textContent = displayName;
            document.getElementById('email').textContent = email;
            // if (user.photoURL){
            //   document.getElementById('photo').src = photoURL;
            //   document.getElementById('photo').style.display = 'block';
            // } else {
            //   document.getElementById('photo').style.display = 'none';
            // }
            document.getElementById('account-details').textContent = JSON.stringify({
              displayName: displayName,
              email: email,
              emailVerified: emailVerified,
              photoURL: photoURL,
              uid: uid,
              accessToken: accessToken,
              providerData: providerData
            }, null, '  ');
            document.getElementById('div-signed-in-1').style.display = 'block';
            document.getElementById('div-signed-in-2').style.display = 'block';
            document.getElementById('div-signed-in-3').style.display = 'block';
            document.getElementById('div-signed-in-4').style.display = 'block';
            document.getElementById('div-signed-out-1').style.display = 'none';
            document.getElementById('div-signed-out-2').style.display = 'none';
            document.getElementById('div-signed-out-3').style.display = 'none';
            document.getElementById('div-signed-out-4').style.display = 'none';
          });
        } else { // User is signed out.
          // document.getElementById('sign-in-status').textContent = 'Signed out';
          // document.getElementById('sign-in').textContent = 'Sign in';
          document.getElementById('account-details').textContent = 'null';
          document.getElementById('div-signed-in-1').style.display = 'none';
          document.getElementById('div-signed-in-2').style.display = 'none';
          document.getElementById('div-signed-in-3').style.display = 'none';
          document.getElementById('div-signed-in-4').style.display = 'none';
          document.getElementById('div-signed-out-1').style.display = 'block';
          document.getElementById('div-signed-out-2').style.display = 'block';
          document.getElementById('div-signed-out-3').style.display = 'block';
          document.getElementById('div-signed-out-4').style.display = 'block';
        }
      }, function(error) { console.log(error); });
    };
    window.addEventListener('load', function() { initApp() });
  </script>
</head>
<body>
<header>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-1">
      <div class="container">
        <div id="div-signed-in-1" class="hiddenz"><button id="sign-out" class="btn btn-warning btn-xs" title="Log out"><i class="pe-sign-out pe-fw"></i> Log out</button> <a href="http://www.pebinary.net/en/clients/" class="btn btn-danger btn-xs"><i class="pe-university pe-fw"></i> Help</a></div>
        <div id="div-signed-out-1" class="hiddenz"><button id="sign-in-with-redirect" class="btn btn-warning btn-xs" title="Log in"><i class="pe-power-off pe-fw"></i> Log in</button> <a href="http://www.pebinary.net/en/clients/" class="btn btn-danger btn-xs"><i class="pe-university pe-fw"></i> Help</a></div>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-2">
      <div class="container">
        <h1><a href="/admin" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><img src="assets/img/ssq.svg" alt="SiamSquare Survey Engine by PE BINARY CO., LTD."></a></h1>
        <p class="description">A survey society where your opinions are highly valued</p>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 header-3">
      <nav class="navbar navbar-default navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <span id="div-signed-out-2" class="navbar-brand"><i class="pe-exclamation-triangle pe-fw"></i> Authorised clients only, please login</span>
            <span id="div-signed-in-2" class="navbar-brand"><i class="pe-smile-o pe-fw"></i> Welcome <span id="displayName"></span> (<span id="email"></span>)</span>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul id="div-signed-out-3" class="nav navbar-nav navbar-right">
              <li><a href="http://www.siamsquare.org/admin/" title="SiamSquare Survey Engine by PE BINARY CO., LTD."><i class="pe-home pe-fw"></i> Home</a></i>
              <li><a href="http://www.siamsquare.org/admin/request.php" title="Request for an access"><i class="pe-ticket pe-fw"></i> Request for an access</a></li>
            </ul>
            <ul id="div-signed-in-3" class="nav navbar-nav navbar-right">
              <li><a href="<?php echo MYADMIN; ?>" title="<?php echo MYDESC; ?>"><i class="pe-home pe-fw"></i> Home</a></i>
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" role="button"><i class="pe-wpforms pe-fw"></i> My surveys <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Current surveys</li>
                  <li><a href="#"><i class="pe-paper-plane pe-fw"></i> Active</a></li>
                  <li><a href="#"><i class="pe-puzzle-piece pe-fw"></i> Non-active</a></li>
                  <li role="separator" class="divider"></li>
                  <li class="dropdown-header">Past surveys</li>
                  <li><a href="#"><i class="pe-archive pe-fw"></i> Archived</a></li>
                  <li role="separator" class="divider"></li>
                  <li class="dropdown-header">Create a survey</li>
                  <li><a href="#"><i class="pe-file-o pe-fw"></i> New survey</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" role="button"><i class="pe-graduation-cap pe-fw"></i> My team <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Team overview</li>
                  <li><a href="#"><i class="pe-user pe-fw"></i> My team</a></li>
                  <li role="separator" class="divider"></li>
                  <li class="dropdown-header">Manage your team</li>
                  <li><a href="#" title="Add a new member"><i class="pe-user-plus pe-fw"></i> Add a new member</a></li>
                  <li><a href="#" title="Member permission"><i class="pe-cogs pe-fw"></i> Member permission</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" role="button"><i class="pe-user pe-fw"></i> My profile <span class="caret"></span></a>
                <ul class="dropdown-menu">
                  <li class="dropdown-header">Manage your profile</li>
                  <li><a href="#" title="Change your info"><i class="pe-cog pe-fw"></i> Change your info</a></li>
                  <li><a href="#" title="Change your password"><i class="pe-key pe-fw"></i> Change your password</a></li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </div>
</header>
<main class="container">


<div class="form-horizontal" id="div-signed-out-4">
  <h2>Client login</h2>
  <p>This section is reserved only for our clients whom we have granted with a high level of secured access. Within this section you will be able to access to a highly confidential data such as questionnaire design, data collected from respondents, reports, etc. We carefully design our system to ensure such high important data is kept separately for different users or user groups.</p>
  <p>Should you need any support for accessing this section, please do not hesitate to contact our staff right away.</p>
  <section class="row">
    <div class="col-xs-12 col-6-12 col-md-6 col-lg-6">
      Login options
    </div>
    <div class="col-xs-12 col-6-12 col-md-6 col-lg-6">
      Forgot password
    </div>
  </section>
  <div class="alert alert-warning alert-dismissible" role="alert"><a class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <h4><i class="pe-exclamation-triangle pe-fw pe-lg"></i> Unauthorised access to this system is prohibited by law</h4>
    <p>You are accessing a private computer network which includes: (1) this machine, (2) this computer network, (3) all computers/servers connected to this network, and (4) all devices and storage media attached to this network or to a computer on this network. This information system is provided for registered clients authorised use only. Unauthorized or improper use of this system may result in disciplinary action, as well as civil and criminal penalties.</p>
    <p>If you do not have an access, please contact sales for setting up a master login/password for your company.</p>
    <p>By using this information system, you understand and consent to the following:</p>
    <ul class="pe-ul">
      <li><i class="pe-li pe-check-square"></i> You have no reasonable expectation of privacy regarding any communication or data transiting or stored on this information system. At any time, and for any lawful purpose, we may monitor, intercept, and search and seize any communication or data transiting or stored on this information system.</li>
      <li><i class="pe-li pe-check-square"></i> Any communication or data transiting or stored on this information system may be disclosed or used for any lawful purpose.</li>
      <li><i class="pe-li pe-check-square"></i> Information you see must not be shared to the public due to our terms of confidentiality.</li>
    </ul>
  </div>
</div>

<div class="" id="div-signed-in-4">
  <h2>My surveys</h2>
  <p>At this page, you will be able to manage all your surveys effectively. You can create a new survey, or move a survey to your archive section, or even delete permanently from your database.</p>
  <br>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <nav>
        <ul class="nav nav-tabs">
          <li data-bind="css: {active: showActive()}"><a class="tabsmenu btn" data-bind="click: loadActive" href=""><i class="pe-cubes pe-fw"></i> Active projects</a></li>
          <li data-bind="css: {active: !showActive()}"><a class="tabsmenu btn" data-bind="click: loadArchive" href=""><i class="pe-archive pe-fw"></i> Past projects</a></li>
        </ul>
      </nav>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <p class="pull-right"><a class="btn btn-sm btn-success" data-bind="click: createNew, visible: showActive, enable: !isNewSurveyCreating()" href=""><i class="pe-cube pe-fw"></i> New project</a></p>
      <br>
      <table class="table table-hover">
        <thead>
          <tr class="bg-success">
            <th width="20%"><i class="pe-cube pe-fw"></i> Project</th>
            <th width="25%"><i class="pe-calendar pe-fw"></i> Created</th>
            <th width="25%"><i class="pe-clock-o pe-fw"></i> Last updated (<i class="pe-sort-amount-desc pe-fw red"></i>)</th>
            <th width="30%"><i class="pe-cogs pe-fw"></i> Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr data-bind="visible: isNewSurveyCreating" class="bg-info">
            <td colspan="3"><input type="text" class="form-control" data-bind="textInput: newSurveyName" placeholder="Enter a new project name"></td>
            <td>
              <a class="btn btn-xs" data-bind="click: postNew, enable: newSurveyName() != ''" href="">Create <i class="pe-check-circle-o"></i></a>
              <a class="btn btn-xs" data-bind="click: cancelNew" href="">Cancel <i class="pe-times-circle-o"></i></a>
            </td>
          </tr>
          <!-- ko foreach: surveys -->
          <tr>
            <td>
              <a href="" data-bind="click: $parent.showInfo" title="More Info..."><i data-bind="css: {'pe-chevron-down': !showInfo(), 'pe-chevron-up': showInfo()}"></i></a>&nbsp;
              <span data-bind="text: title"></span>
              <a href="" data-bind="click: $parent.startEdit, visible: $parent.showActive" title="Change Name"> <i class="pe-edit"></i></a>
            </td>
            <td>
              <span data-bind="text: created"></span>
            </td>
            <td>
              <span data-bind="text: lastupdated"></span>
            </td>
            <td>
              <a class="btn btn-default btn-xs" data-bind="attr: { href: 'edit.html?s=' + id }, visible: $parent.showActive">Edit <i class="pe-edit"></i></a>
              <a class="btn btn-default btn-xs" data-bind="attr: { href: 'run.html?s=' + id }, visible: $parent.showActive">Run <i class="pe-paper-plane"></i></a>
              <a class="btn btn-warning btn-xs" data-bind="click: $parent.archive, visible: $parent.showActive" href="">Archive <i class="pe-archive"></i></a>
              <a class="btn btn-default btn-xs" data-bind="attr: { href: 'result.html?s=' + id }, visible: !$parent.showActive()">Results <i class="pe-pie-chart"></i></a>
              <a class="btn btn-default btn-xs" data-bind="click: $parent.restore, visible: !$parent.showActive()" href="">Restore <i class="pe-undo"></i></a>
              <a class="btn btn-danger btn-xs" data-bind="click: $parent.delete, visible: !$parent.showActive()" href="">Delete <i class="pe-trash"></i></a>
            </td>
          </tr>
          <tr data-bind="visible: isEditing()" class="bg-info">
            <td colspan="2">
              <input data-bind="textInput: editingName, visible: isEditing()" class="form-control">
            </td>
            <td>
              <a class="btn btn-sm" data-bind="click: $parent.postEdit, enable: title() != ''" href="">Rename <i class="pe-check-circle-o"></i></a>
              <a class="btn btn-sm" data-bind="click: $parent.cancelEdit" href="">Cancel <i class="pe-times-circle-o"></i></a>
            </td>
            <td></td>
          </tr>
          <tr data-bind="visible: showInfo">
            <td colspan="4" class="bg-warning">
              <dl class="dl-horizontal">
                <dt>Id</dt>
                <dd><span data-bind="text: id"></span></dd>
                <dt>resultid</dt>
                <dd><span data-bind="text: resultid"></span></dd>
                <dt>postid</dt>
                <dd><span data-bind="text: postid"></span></dd>
              </dl>
            </td>
          </tr>
          <!-- /ko -->
        </tbody>
      </table>
    </div>
  </div>
  <div id="confirmdeletebox" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">You are about to delete this project from our database!</h4>
        </div>
        <div class="modal-body">
          <p>You need to consider this very carefully. At least you should be aware that once this process is done it will not be reversible.</p>
          <p>And all data regarding to this project, such as the questionaire, all responses collected from respondents, the final data file, etc., will be gone forever.</p>
          <p>Are you sure you still want to proceed?</p>
        </div>
        <div class="modal-footer">
          <a class="btn btn-danger" data-bind="click: $root.delete, visible: !$root.showActive()" href="" id="btnYes">Delete <i class="pe-check-circle-o"></i></a>
          <button type="button" data-dismiss="modal" class="btn btn-default">Cancel <i class="pe-times-circle-o"></i></button>
        </div>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="assets/js/pe.js"></script>
</div>

<br>

<h4>Debug</h4>
<pre><code id="account-details">null</code></pre>
<div id="sign-in-with-popup"></div>
<div id="delete-account"></div>
<div id="account-details"></div>

</main>
<footer>
  <div class="row">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-1">
      <div class="container">
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-2">
      <div class="container">
        <a href="/" class="footerlogo-ssq" title="MYDESC"><span class="ssqlogo1">Siam</span><span class="ssqlogo2">Square</span></a> by
        <a href="http://www.pebinary.com" class="footerlogo" title="PE BINARY CO., LTD."><span class="logo1"><i class="pe-logo"></i></span> <span class="logo2">pe</span><span class="logo3">binary</span></a><br>
        <i class="pe-copyright"></i> Copyright 2016, All rights reserved.<br>
        <nav class="footer">
          <ul class="list-inline" itemscope itemtype="http://schema.org/SiteNavigationElement">
            <li><a href="http://www.pebinary.com/about/privacy.html" title="Privacy policy" itemprop="url"><i class="pe-lock"></i> <span class="hidden-md hidden-lg" itemprop="name">Privacy</span><span class="hidden-xs hidden-sm" itemprop="name">Privacy policy</span></a></li>
            <li><a href="http://www.pebinary.com/about/tos.html" title="Terms of services" itemprop="url"><i class="pe-gavel"></i> <span class="hidden-md hidden-lg" itemprop="name">TOS</span><span class="hidden-xs hidden-sm" itemprop="name">Terms of services</span></a></li>
            <li><a href="http://www.pebinary.com/about/terms.html" title="Terms &amp; conditions" itemprop="url"><i class="pe-balance-scale"></i> <span class="hidden-md hidden-lg" itemprop="name">Terms</span><span class="hidden-xs hidden-sm" itemprop="name">Terms &amp; conditions</span></a></li>
          </ul>
        </nav>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 footer-3">
      <div class="container">
        <h4 class="avatar">&#9836; &#9819; &#9962; &#9969; &#9748; &#10000; &#10175; &#9820; &#9822; &#9731; &#9973; &#8485; &#8488; &#8523; &#8492; &#9961;</h4>
      </div>
    </div>
  </div>
</footer>
<div class="scroll-to-top"><i class="pe-arrow-up pe-lg"></i></div>
<script>
  (function (i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function (){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-82554411-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
